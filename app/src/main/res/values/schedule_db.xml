<?xml version="1.0" encoding="utf-8"?>
<resources>
    <string name="bus_trip_schedule_query">
SELECT
start.arrival_time DepartureTime,
Stop.arrival_time  ArrivalTime,
Start.block_id
FROM

(SELECT
T.trip_id,
ST.arrival_time,
T.block_id
FROM
stop_times_{4} ST
JOIN trips_{4} T
ON ST.trip_id = T.trip_id
WHERE ST.stop_id = {0} and T.direction_id = {2} and T.service_id in (select service_id from calendar_bus C where days &amp; {1})) Start

JOIN (SELECT
T.trip_id, T.direction_id, T.service_id,
ST.arrival_time
FROM
stop_times_{4}  ST
JOIN trips_{4} T
ON ST.trip_id = T.trip_id
WHERE  stop_id = {3} and T.direction_id = {2} and T.service_id in (select service_id from calendar_bus C where days &amp; {1})) Stop
ON start.trip_id = stop.trip_id
group by start.arrival_time, Stop.arrival_time
ORDER BY DepartureTime;
    </string>

    <string name="rail_trip_schedule_query">
SELECT
start.arrival_time DepartureTime,
Stop.arrival_time  ArrivalTime,
start.block_id
FROM

(SELECT
T.trip_id,T.route_id,
ST.arrival_time,
T.block_id
FROM
stop_times_rail ST
JOIN trips_rail T
ON ST.trip_id = T.trip_id
WHERE ST.stop_id = {0} and T.direction_id = {2} and T.service_id in (select service_id from calendar_rail C where days &amp; {1})) Start

JOIN (SELECT
T.trip_id, T.direction_id, T.service_id,
ST.arrival_time
FROM
stop_times_rail ST
JOIN trips_rail T
ON ST.trip_id = T.trip_id
WHERE  stop_id = {3} and T.direction_id = {2}  and T.service_id in (select service_id from calendar_rail  C where days &amp; {1})) Stop
ON start.trip_id = stop.trip_id
group by start.arrival_time, stop.arrival_time;

</string>


    <!--route_id={0}, direction_id={1} -->
    <string name="rail_trip_start">
SELECT
  S.stop_id                   stopId,
  S.stop_name                 stopName,
  cast(S.stop_lat AS DECIMAL) stopLatitude,
  cast(S.stop_lon AS DECIMAL) stopLongitude,
  CASE WHEN S.wheelchair_boarding = \'1\'
    THEN 1
  ELSE 0 END                  wheelchairBoarding,
  MAX(CASE WHEN T.service_id = \'1\'
    THEN 1
      ELSE 0 END)             weekdayService,
  MAX(CASE WHEN
    T.service_id = \'2\'
    THEN 1
      ELSE 0 END)             saturdayService,
  MAX(CASE WHEN
    T.service_id = \'3\'
    THEN 1
      ELSE 0 END) AS          sundayService
FROM
  stop_times_rail ST
  JOIN trips_rail T ON T.trip_id = ST.trip_id
  JOIN stops_rail S ON ST.stop_id = S.stop_id

  JOIN (SELECT
          ST.stop_sequence,
          T.trip_id
        FROM routes_rail_boundaries B
          JOIN trips_rail T ON B.route_id = T.route_id
          JOIN stop_times_rail ST ON T.trip_id = ST.trip_id
        WHERE B.route_id = \"{0}\" AND B.direction_id = \"{1}\" AND ST.stop_id = B.lineStart_stop_id
       ) LineStart
    ON ST.stop_sequence >= LineStart.stop_sequence AND ST.trip_id = LineStart.trip_id


  JOIN (SELECT
          ST.stop_sequence,
          T.trip_id
        FROM routes_rail_boundaries B
          JOIN trips_rail T ON B.route_id = T.route_id
          JOIN stop_times_rail ST ON T.trip_id = ST.trip_id
        WHERE B.route_id = \"{0}\" AND B.direction_id = \"{1}\" AND ST.stop_id = B.lineEnd_stop_id
       ) LineEnd
    ON ST.stop_sequence &lt;= LineEnd.stop_sequence AND ST.trip_id = LineEnd.trip_id

WHERE T.route_id = \"{0}\" AND T.direction_id = \"{1}\"
    </string>


    <!--route_id={0}, direction_id={1}, stop_id={2} -->
    <string name="rail_trip_end">
SELECT
  S.stop_id                   stopId,
  S.stop_name                 stopName,
  cast(S.stop_lat AS DECIMAL) stopLatitude,
  cast(S.stop_lon AS DECIMAL) stopLongitude,
  CASE WHEN S.wheelchair_boarding = \'1\'
    THEN 1
  ELSE 0 END                  wheelchairBoarding,
  MAX(CASE WHEN T.service_id = \'1\'
    THEN 1
      ELSE 0 END)             weekdayService,
  MAX(CASE WHEN
    T.service_id = \'2\'
    THEN 1
      ELSE 0 END)             saturdayService,
  MAX(CASE WHEN
    T.service_id = \'3\'
    THEN 1
      ELSE 0 END) AS          sundayService
FROM trips_rail T
  JOIN routes_rail R
    ON T.route_id = R.route_id
  JOIN stop_times_rail ST
    ON T.trip_id = ST.trip_id
  JOIN stops_rail S
    ON ST.stop_id = S.Stop_id
  JOIN (SELECT
          T.trip_id,
          ST.stop_sequence
        FROM trips_rail T
          JOIN stop_times_rail ST
            ON T.trip_id = ST.trip_id
        WHERE route_id = \"{0}\" AND T.direction_id = \"{1}\" AND ST.stop_id = {2}) Start
    ON T.trip_id = Start.trip_id AND ST.stop_sequence > Start.stop_sequence
  JOIN (SELECT
          ST.stop_sequence,
          T.trip_id
        FROM routes_rail_boundaries B
          JOIN trips_rail T ON B.route_id = T.route_id
          JOIN stop_times_rail ST ON T.trip_id = ST.trip_id
        WHERE B.route_id = \"{0}\" AND B.direction_id = \"{1}\" AND ST.stop_id = B.lineStart_stop_id
       ) LineStart
    ON ST.stop_sequence >= LineStart.stop_sequence AND ST.trip_id = LineStart.trip_id


  JOIN (SELECT
          ST.stop_sequence,
          T.trip_id
        FROM routes_rail_boundaries B
          JOIN trips_rail T ON B.route_id = T.route_id
          JOIN stop_times_rail ST ON T.trip_id = ST.trip_id
        WHERE B.route_id = \"{0}\" AND B.direction_id = \"{1}\" AND ST.stop_id = B.lineEnd_stop_id
       ) LineEnd
    ON ST.stop_sequence &lt;= LineEnd.stop_sequence AND ST.trip_id = LineEnd.trip_id

WHERE T.route_id = \"{0}\" AND direction_id = \"{1}\"
    </string>
</resources>